generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Team {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique // Para URLs amig√°veis (ex: /team/marketing)
  description String?
  domain      String?  // Dom√≠nio personalizado opcional
  settings    Json?    // Configura√ß√µes espec√≠ficas do team
  email       String?  @unique // Email para autentica√ß√£o
  password    String?  // Senha hash
  isActive    Boolean  @default(true) // Team ativo/inativo
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  sections        Section[]
  categories      Category[]
  items           Item[]
  menuItems       MenuItem[]
  sectionTypeGroups SectionTypeGroup[]
  reports         Report[]
  members         TeamMember[]

  @@map("teams")
}

model Section {
  id          String      @id @default(cuid())
  name        String
  description String?
  type        SectionType @default(CUSTOM)
  order       Int         @default(0)
  isActive    Boolean     @default(true) // Se√ß√£o ativa/inativa
  teamId      String      @map("team_id")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  // Relacionamentos
  team        Team        @relation(fields: [teamId], references: [id], onDelete: Cascade)
  items       Item[]

  @@unique([name, teamId]) // Nome √∫nico por team
  @@index([teamId])
  @@map("sections")
}

enum SectionType {
  FIXED
  CUSTOM
  MENU
  MATEUS
  CUSTOM_1
  CUSTOM_2
  CUSTOM_3
  CUSTOM_4
  CUSTOM_5
}

model Category {
  id          String   @id @default(cuid())
  name        String
  description String?
  color       String   @default("#6B7280") // Cor para identifica√ß√£o visual
  teamId      String   @map("team_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  items       Item[]

  @@unique([name, teamId]) // Nome √∫nico por team
  @@index([teamId])
  @@map("categories")
}

model Item {
  id         String    @id @default(cuid())
  title      String
  content    String
  tags       String[]
  sectionId  String    @map("section_id")
  categoryId String?   @map("category_id")
  teamId     String    @map("team_id")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")

  // Relacionamentos
  team       Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  section    Section   @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  category   Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([title])
  @@index([sectionId])
  @@index([categoryId])
  @@index([teamId])
  @@map("items")
}

model MenuItem {
  id          String   @id @default(cuid())
  name        String
  href        String
  icon        String
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  teamId      String   @map("team_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([teamId])
  @@map("menu_items")
}

model SectionTypeGroup {
  id            String      @id @default(cuid())
  name          String
  description   String?
  icon          String      @default("üìÅ")
  color         String      @default("#3B82F6")
  order         Int         @default(0)
  active        Boolean     @default(true)
  sectionFilter SectionType @default(CUSTOM)
  teamId        String      @map("team_id")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  // Relacionamentos
  team          Team        @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([teamId])
  @@map("section_type_groups")
}

model Report {
  id           String      @id @default(cuid())
  title        String
  content      String
  status       ReportStatus @default(PUBLISHED)
  category     String
  tags         String[]
  author       String      @default("Sistema")
  template     String?     // Template usado para criar o relat√≥rio
  templateData Json?       // Dados do formul√°rio do template
  teamId       String      @map("team_id")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")

  // Relacionamentos
  team         Team        @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([category])
  @@index([createdAt])
  @@index([teamId])
  @@map("reports")
}

enum ReportStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model TeamMember {
  id          String     @id @default(cuid())
  name        String
  email       String
  position    String?    // Cargo/fun√ß√£o no team
  department  String?    // Departamento
  phone       String?    // Telefone
  isActive    Boolean    @default(true) // Membro ativo/inativo
  joinDate    DateTime   @default(now()) @map("join_date") // Data de entrada no team
  notes       String?    // Observa√ß√µes sobre o membro
  teamId      String     @map("team_id")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")

  // Relacionamentos
  team        Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([email, teamId]) // Email √∫nico por team
  @@index([teamId])
  @@index([isActive])
  @@map("team_members")
}
